{"ast":null,"code":"import{useEffect,useRef,useState}from'react';export const useAudioAnalyzer=onAudioLevel=>{const[isListening,setIsListening]=useState(false);const[audioLevel,setAudioLevel]=useState(0);const audioContextRef=useRef(null);const analyzerRef=useRef(null);const microphoneRef=useRef(null);const dataArrayRef=useRef(null);const animationFrameRef=useRef(null);const startListening=async()=>{try{var _audioContextRef$curr;if(((_audioContextRef$curr=audioContextRef.current)===null||_audioContextRef$curr===void 0?void 0:_audioContextRef$curr.state)==='suspended'){await audioContextRef.current.resume();}if(!audioContextRef.current){audioContextRef.current=new(window.AudioContext||window.webkitAudioContext)();}const stream=await navigator.mediaDevices.getUserMedia({audio:true});microphoneRef.current=audioContextRef.current.createMediaStreamSource(stream);analyzerRef.current=audioContextRef.current.createAnalyser();analyzerRef.current.fftSize=256;analyzerRef.current.smoothingTimeConstant=0.8;microphoneRef.current.connect(analyzerRef.current);const bufferLength=analyzerRef.current.frequencyBinCount;dataArrayRef.current=new Uint8Array(bufferLength);setIsListening(true);analyzeAudio();}catch(error){console.error('Error accessing microphone:',error);}};const stopListening=()=>{if(animationFrameRef.current){cancelAnimationFrame(animationFrameRef.current);}if(microphoneRef.current){microphoneRef.current.disconnect();microphoneRef.current=null;}if(audioContextRef.current&&audioContextRef.current.state!=='closed'){audioContextRef.current.close();audioContextRef.current=null;}setIsListening(false);setAudioLevel(0);};const analyzeAudio=()=>{if(!analyzerRef.current||!dataArrayRef.current)return;analyzerRef.current.getByteFrequencyData(dataArrayRef.current);// Calculate average volume\nconst average=dataArrayRef.current.reduce((sum,value)=>sum+value,0)/dataArrayRef.current.length;const normalizedLevel=Math.min(average/128,1);// Normalize to 0-1\nsetAudioLevel(normalizedLevel);if(onAudioLevel){onAudioLevel(normalizedLevel);}animationFrameRef.current=requestAnimationFrame(analyzeAudio);};useEffect(()=>{return()=>{stopListening();};},[]);return{startListening,stopListening,isListening,audioLevel};};","map":{"version":3,"names":["useEffect","useRef","useState","useAudioAnalyzer","onAudioLevel","isListening","setIsListening","audioLevel","setAudioLevel","audioContextRef","analyzerRef","microphoneRef","dataArrayRef","animationFrameRef","startListening","_audioContextRef$curr","current","state","resume","window","AudioContext","webkitAudioContext","stream","navigator","mediaDevices","getUserMedia","audio","createMediaStreamSource","createAnalyser","fftSize","smoothingTimeConstant","connect","bufferLength","frequencyBinCount","Uint8Array","analyzeAudio","error","console","stopListening","cancelAnimationFrame","disconnect","close","getByteFrequencyData","average","reduce","sum","value","length","normalizedLevel","Math","min","requestAnimationFrame"],"sources":["C:/Users/Krish/jarvis/web_gui/src/components/AudioAnalyzer.jsx"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\r\n\r\nexport const useAudioAnalyzer = (onAudioLevel) => {\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [audioLevel, setAudioLevel] = useState(0);\r\n  const audioContextRef = useRef(null);\r\n  const analyzerRef = useRef(null);\r\n  const microphoneRef = useRef(null);\r\n  const dataArrayRef = useRef(null);\r\n  const animationFrameRef = useRef(null);\r\n\r\n  const startListening = async () => {\r\n    try {\r\n      if (audioContextRef.current?.state === 'suspended') {\r\n        await audioContextRef.current.resume();\r\n      }\r\n\r\n      if (!audioContextRef.current) {\r\n        audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();\r\n      }\r\n\r\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n      microphoneRef.current = audioContextRef.current.createMediaStreamSource(stream);\r\n      analyzerRef.current = audioContextRef.current.createAnalyser();\r\n      \r\n      analyzerRef.current.fftSize = 256;\r\n      analyzerRef.current.smoothingTimeConstant = 0.8;\r\n      \r\n      microphoneRef.current.connect(analyzerRef.current);\r\n      \r\n      const bufferLength = analyzerRef.current.frequencyBinCount;\r\n      dataArrayRef.current = new Uint8Array(bufferLength);\r\n      \r\n      setIsListening(true);\r\n      analyzeAudio();\r\n    } catch (error) {\r\n      console.error('Error accessing microphone:', error);\r\n    }\r\n  };\r\n\r\n  const stopListening = () => {\r\n    if (animationFrameRef.current) {\r\n      cancelAnimationFrame(animationFrameRef.current);\r\n    }\r\n    \r\n    if (microphoneRef.current) {\r\n      microphoneRef.current.disconnect();\r\n      microphoneRef.current = null;\r\n    }\r\n    \r\n    if (audioContextRef.current && audioContextRef.current.state !== 'closed') {\r\n      audioContextRef.current.close();\r\n      audioContextRef.current = null;\r\n    }\r\n    \r\n    setIsListening(false);\r\n    setAudioLevel(0);\r\n  };\r\n\r\n  const analyzeAudio = () => {\r\n    if (!analyzerRef.current || !dataArrayRef.current) return;\r\n\r\n    analyzerRef.current.getByteFrequencyData(dataArrayRef.current);\r\n    \r\n    // Calculate average volume\r\n    const average = dataArrayRef.current.reduce((sum, value) => sum + value, 0) / dataArrayRef.current.length;\r\n    const normalizedLevel = Math.min(average / 128, 1); // Normalize to 0-1\r\n    \r\n    setAudioLevel(normalizedLevel);\r\n    \r\n    if (onAudioLevel) {\r\n      onAudioLevel(normalizedLevel);\r\n    }\r\n\r\n    animationFrameRef.current = requestAnimationFrame(analyzeAudio);\r\n  };\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      stopListening();\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    startListening,\r\n    stopListening,\r\n    isListening,\r\n    audioLevel\r\n  };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}